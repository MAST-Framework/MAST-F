{% extends 'project/results/results-base.html' %}
{% load static %}
{% block content %}

{% if 'details' in extensions %}
<div class="tab-pane {% if active == "tabs-details" %}active show{% endif %}"
    id="tabs-details">
    {% if active == "tabs-details" %}
        {% with data.details as details %}

        {% if details %}
            <div class="row">
                <div class="datagrid">
                    <div class="row row-cols-2">
                        <div class="col-md-3">
                            <div class="datagrid-item me-2">
                                <div class="datagrid-title">Scan Target</div>
                                <div class="datagrid-content">
                                    <div class="row">
                                        <div class="col-auto">
                                            <span class="avatar avatar-lg rounded">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-question-mark" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                    <path d="M8 8a3.5 3 0 0 1 3.5 -3h1a3.5 3 0 0 1 3.5 3a3 3 0 0 1 -2 3a3 4 0 0 0 -2 4"></path>
                                                    <path d="M12 19l0 .01"></path>
                                                    </svg>
                                            </span>
                                        </div>
                                        <div class="col text-truncate align-left text-left">
                                            <span class="text-muted h4">
                                                <b>
                                                    {% if details.name %}
                                                    {{ details.name }}
                                                    {% else %}
                                                    &lt; Name not defined &gt;
                                                    {% endif %}
                                                </b>
                                            </span>
                                            <div class="text-muted text-truncate mt-n1">
                                                {% if scan.scan_type %}
                                                {{ scan.scan_type }}
                                                {% else %}
                                                No Scan Type defined
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="row row-cols-3 align-items-center">
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">CVSS</div>
                                        <div class="datagrid-content">
                                            {% if details.cvss %}
                                            <span class="badge badge-outline
                                                {% if details.cvss > 9 %}bg-pink-lt
                                                {% elif details.cvss > 7 %}bg-red-lt
                                                {% elif details.cvss > 4 %}bg-orange-lt
                                                {% elif details.cvss > 1 %}bg-yellow-lt
                                                {% else %}bg-secondary-lt
                                                {% endif %}">
                                                {{ details.cvss }}
                                            </span>
                                            {% else %}
                                            <span class="badge badge-outline bg-secondary-lt">
                                                Not Set
                                            </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">Risk Level</div>
                                        <div class="datagrid-content">
                                            {% if details.scan.risk_level %}
                                            {% with details.scan.risk_level|lower as level %}
                                            <span class="badge badge-outline
                                                {% if level == 'high' %}bg-red-lt
                                                {% elif level == 'critical' %}bg-pink-lt
                                                {% elif level == 'medium' %}bg-orange-lt
                                                {% elif level == 'low' %}bg-yellow-lt
                                                {% elif level == 'info' %}bg-primary-lt
                                                {% elif level == 'secure' %}bg-green-lt
                                                {% else %}bg-secondary-lt
                                                {% endif %}">
                                                {{ details.scan.risk_level }}
                                            </span>
                                            {% endwith %}
                                            {% else %}
                                            <span class="badge badge-outline bg-secondary-lt">
                                                Undefined
                                            </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">Trackers</div>
                                        <div class="datagrid-content">
                                            <span class="text-muted">
                                            {% if details.tracker_count %}
                                            {{ details.tracker_count }}
                                            {% else %}
                                            No Trackers found
                                            {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row row-cols-3 align-items-center mt-3">
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">File Name</div>
                                        <div class="datagrid-content">
                                            <span class="text-muted">
                                                {% if details.file.file_name %}
                                                {{ details.file.file_name }}
                                                {% else %}
                                                No File Name provided
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">File Size</div>
                                        <div class="datagrid-content">
                                            <span class="text-muted">
                                                {% if details.file.file_size %}
                                                {{ details.file.file_size|filesizeformat }}
                                                {% else %}
                                                0 Bytes
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="datagrid-item">
                                        <div class="datagrid-title">MD5</div>
                                        <div class="datagrid-content text-muted">
                                            {% if details.file.md5 %}
                                            {{ details.file.md5 }}
                                            {% else %}
                                            &lt; Undefined &gt;
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if details.store %}
            <div class="hr-text">{{ details.store.name }} information</div>
            <div class="row">
            <div class="datagrid">
                {% with details.store as store %}
                {% for info in store.fields %}
                <div class="datagrid-item">
                    <div class="datagrid-title">{{ info.name }}</div>

                    <div class="datagrid-content">
                        {% if info.type == "str" %}
                        {{ info.value }}

                        {% elif info.type == "link" %}
                        <a target="_blank" href="{{ info.link }}" rel="noopener noreferer"
                            class="link-secondary">
                            <i>{{ info.value }}</i>
                        </a>
                        {% elif info.type == "badge" %}
                        <span class="badge {{ info.color }} mb-1">
                            {{ info.value }}
                        </span>
                        {% endif %}
                    </div>

                </div>
                {% endfor %}
                {% endwith %}
            </div>
            </div>


        {% endif %}

        {% else %}
        <div class="row flex-column justify-content-center">
            <div class="empty">
            <p class="empty-title">No details specified</p>
            <p class="empty-subtitle text-muted">
                If the process has finished, there might be more results
            </p>
            </div>
        </div>

        {% endif %}
        {% endwith %}
        </div>

    {% endif %}
</div>
{% endif %}
{% endblock content %}