{% extends 'user/settings/settings-base.html' %}
{% load static %}
{% load mastf_tags %}

{% block content %}
<div class="card">
    <div class="card-body">
        <p class="subheader">Account Data</p>
       <div class="row align-items-center m-1 mt-2">
           <div class="col-auto">
               <span class="avatar avatar-lg rounded">{{user.username|capfirst|first}}</span>
           </div>
           <div class="col">
                <input type="text" class="form-control form-control-flush fw-bold h1" name="username" placeholder="Username"
                    value="{{request.user.username}}" minlength="5" id="user-name">
                <input type="text" class="form-control form-control-flush my-2" name="description" placeholder="Description of your job" value="">
               <div class="list-inline list-inline-dots text-muted">
                   <div class="list-inline-item">
                       <!-- Download SVG icon from http://tabler-icons.io/i/map -->
                       <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user-circle" width="28" height="28" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path><path d="M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path><path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"></path></svg>
                       {% if account.role == 'Admin' %}
                       <span class="badge bg-purple-lt">Admin</span>
                       {% elif  account.role == 'Regular' %}
                       <span class="badge bg-teal-lt">Regular</span>
                       {% elif account.role == 'External' %}
                       <span class="badge bg-azure-lt">External</span>
                       {% else %}
                       <span class="badge bg-secondary-lt">{{account.role}}</span>
                       {% endif %}

                   </div>
                   <div class="list-inline-item">
                       <!-- Download SVG icon from http://tabler-icons.io/i/mail -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-inline" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z" /><path d="M3 7l9 6l9 -6" /></svg>
                        <a href="#" class="text-reset">
                            {{user.email|default:"no email provided"}}
                        </a>
                   </div>
               </div>
           </div>
       </div>
    </div>
</div>
<div class="card mt-2 ms-4 border-0">
    <div class="card-body">
        <div class="row">
            <div class="col-md-4 mb-1">
                <label class="from-label h3">E-Mail</label>
                <input type="text" class="form-control" id="" placeholder="foo@example.com" value="{{request.user.email}}"
                    id="user-email">
                <span class="form-check-description mb-1">The email can be used as an additional field in generated reports. Use
                    <code class="highlight highlight-inline"><span class="mi">${</span>user.email<span class="mi">}</span></code> in report templates to reference this value.</span>
            </div>
            <div class="col-md-3">
                <label class="from-label h3">User ID</label>
                <input type="text" class="form-control" id="" value="{{request.user.pk}}" disabled>
                <span class="form-check-description mb-1">The user id is unique and can be used to identify your account.</span>
            </div>
            <div class="col">
                <div class="btn-list justify-content-end">
                    <a href="#" class="btn btn-primary" onclick="updateUser();">
                        <span id="spinner-status" style="display: none;">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        </span>
                        <span id="btn-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5l10 -10" /></svg>
                        </span>
                        Save Changes
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="card m-4 border-danger">
    <div class="card-header">
        <span class="fw-bold">Danger Zone</span>
    </div>
    <div class="card-body">
        <div class="row border-bottom mb-3">
            <div class="col mb-1">Delete Account
                <span class="form-check-description">
                    Delete this account and all data related to it.
                </span>
            </div>
            <div class="col-auto">
                <button class="btn btn-outline-danger">Delete Account</button>
            </div>
        </div>
        <div class="row border-bottom mb-3">
            <div class="col mb-1">Change Password
                <span class="form-check-description">
                    Change the current password for this account. Make sure to save your password, otherwise your data may be lost.
                </span>
            </div>
            <div class="col-auto justify-content-center">
                <button class="btn btn-outline-danger">Change Password</button>
            </div>
        </div>
    </div>
</div>
{% endblock content %}


{% block js_extended %}
<script>
    function updateUser() {
        $('#icon-btn').addClass('visually-hidden');
        $('#spinner-status').removeClass('visually-hidden');
        let email = Utils.getValue('user-email');
        let username = Utils.getValue('user-name');

        data = {}
        if (email != null) {
            data['email'] = email;
        }
        if (username != null && username.length > 5) {
            data['username'] = username;
        }

        REST.patch("{% url 'User-View' user.pk %}", JSON.stringify(data), function(data) {
            if (data.success) {
                REST.patch("{% url 'Account-View' account.pk %}", JSON.stringify({
                    description: Utils.getValue("user-description"),
                }), function(data) {

                    $('#icon-btn').removeClass('visually-hidden');
                    $('#spinner-status').addClass('visually-hidden');
                });
            }
        });
    };
</script>
{% endblock js_extended %}